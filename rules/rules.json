{
  "rules": [
    {
      "name": "Credit Hold: escalate to finance and set flag",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["credit_hold"],
        "payment_hold": false
      },
      "then": [
        {"action": "send_email", "to": "finance", "scenario": "credit_hold_alert"},
        {"action": "set_flag", "flag": "payment_hold", "value": true}
      ]
    },
    {
      "name": "Missing delivery date â†’ ask buyer and set flag",
      "when": {
        "status_is": "ISSUED",
        "delivery_date_missing": true,
        "needs_info": false
      },
      "then": [
        {"action": "send_email", "to": "buyer", "scenario": "missing_delivery_date_request"},
        {"action": "set_flag", "flag": "needs_info", "value": true}
      ]
    },
    {
      "name": "Acknowledgment reminder after 24h",
      "when": {
        "status_is": "ISSUED",
        "awaiting_acknowledgment": false,
        "sla_hours_over": 24
      },
      "then": [
        {"action": "send_email", "to": "supplier", "scenario": "acknowledgment_reminder"},
        {"action": "set_flag", "flag": "awaiting_acknowledgment", "value": true}
      ]
    },
    {
      "name": "Lapsed delivery follow-up",
      "when": {
        "from_role": ["system"],
        "status_not_in": ["DELIVERED", "CLOSED", "CANCELLED"],
        "delivery_date_past": true,
        "overdue": false
      },
      "then": [
        {"action": "send_email", "to": "supplier", "scenario": "delivery_delay_followup"},
        {"action": "set_flag", "flag": "overdue", "value": true}
      ]
    },
    {
      "name": "Supplier confirms delivery -> mark delivered",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["delivery_completed"]
      },
      "then": [
        {"action": "update_status", "value": "DELIVERED"},
        {"action": "set_flag", "flag": "overdue", "value": false}
      ]
    },
    {
      "name": "Supplier confirms acknowledgment -> update status",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["acknowledgment"]
      },
      "then": [
        {"action": "update_status", "value": "ACKNOWLEDGED"},
        {"action": "set_flag", "flag": "awaiting_acknowledgment", "value": false}
      ]
    },
    {
      "name": "Vendor partial availability -> notify buyer and set flag",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["partial_availability"],
        "partial_availability": false
      },
      "then": [
        {"action": "send_email", "to": "buyer", "scenario": "partial_quantity_confirmation"},
        {"action": "set_flag", "flag": "partial_availability", "value": true}
      ]
    },
    {
      "name": "ETA Lapsed: follow up with supplier",
      "when": {
        "from_role": ["system"],
        "keyword_in": ["eta_lapsed"]
      },
      "then": [
        {"action": "send_email", "to": "supplier", "scenario": "vendor_no_response_followup"}
      ]
    },
    {
      "name": "Discrepancy detected -> request clarification and set flag",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["clarification_needed"],
        "clarification_requested": false
      },
      "then": [
        {"action": "send_email", "to": "supplier", "scenario": "request_clarification"},
        {"action": "set_flag", "flag": "clarification_requested", "value": true}
      ]
    },
    {
      "name": "MTC Missing: request from supplier and set flag",
      "when": {
        "from_role": ["system"],
        "keyword_in": ["mtc_missing"],
        "mtc_pending": false
      },
      "then": [
        {"action": "send_email", "to": "supplier", "scenario": "request_mtc"},
        {"action": "set_flag", "flag": "mtc_pending", "value": true}
      ]
    },
    {
      "name": "Technical query forward to engineering",
      "when": {
        "from_role": ["supplier"],
        "intent_in": ["technical_query"]
      },
      "then": [
        {"action": "send_email", "to": "engineering", "scenario": "technical_query_forward"}
      ]
    }
  ]
}
